USE WAREHOUSE COMPUTE_WH;
USE DATABASE SNOWFLAKE_LEARNING_DB;

CREATE SCHEMA IF NOT EXISTS SILVER;

CREATE OR REPLACE TABLE SILVER.STORE_SALES_CLEAN AS
SELECT SS.SS_SOLD_DATE_SK,
    SS.SS_STORE_SK,
    SS.SS_CUSTOMER_SK,
    SS.SS_QUANTITY,
    SS.SS_SALES_PRICE
FROM BRONZE.STORE_SALES SS
JOIN SNOWFLAKE_SAMPLE_DATA.TPCDS_SF100TCL.DATE_DIM D
    ON SS.SS_SOLD_DATE_SK = D.D_DATE_SK
WHERE D.D_YEAR BETWEEN 1998 AND 1999
    AND SS.SS_SALES_PRICE IS NOT NULL
    AND SS.SS_QUANTITY > 0;

DESC TABLE SILVER.STORE_SALES_CLEAN;

SELECT MIN(SS_SALES_PRICE), MAX(SS_SALES_PRICE) FROM SILVER.STORE_SALES_CLEAN;

SELECT COUNT(*) FROM BRONZE.STORE_SALES;
SELECT COUNT(*) FROM SILVER.STORE_SALES_CLEAN
WHERE SS_SALES_PRICE <= 0;

SELECT COUNT(*) FROM SILVER.STORE_SALES_CLEAN
WHERE SS_SALES_PRICE IS NULL;

SELECT COUNT(*) FROM SILVER.STORE_SALES_CLEAN
WHERE SS_QUANTITY <= 0;